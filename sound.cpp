///////////////////////////////////////////////////////////////////////////////
// sound.cpp
// 効果音と音楽の再生
// Richard S. Wright Jr.
//
///////////////////////////////////////////////////////////////////////////////

// Win32の必要のない機能は省きます
#define WIN32_LEAN_AND_MEAN

// Windowsヘッダー (マルチメディア機能を利用)
#include <windows.h>
#include <mmsystem.h>
#include <stdio.h>
#include "dsound.h"

///////////////////////////////////////////////////////////////////////////////
//MIDIファイルの音楽の再生を開始する関数
///////////////////////////////////////////////////////////////////////////////
void StartBackgroundMusic(HWND hWnd)
	{
	// 処理中のMCIデバイスがあればクローズ、エラーならリターン
	if(mciSendString("close all", NULL, 0,  0) != 0)
	    return;

	// openコマンドに失敗したらリターンするだけ
    if (mciSendString("open mtnkin2.mid type sequencer alias MUSIC", NULL, 0, 0) != 0)
        return;

	// ファイルを再生します (終わったらアプリケーションに通知されます)
	mciSendString("play MUSIC from 0 notify", NULL, 0, hWnd);
	}


///////////////////////////////////////////////////////////////////////////////
// MCIデバイスから音楽の再生が終わったことが通知されたとき、
// アプリケーションが呼び出す関数
///////////////////////////////////////////////////////////////////////////////
void ReplayBackgroundMusic(HWND hWnd)
	{
	mciSendString("play MUSIC from 0 notify", NULL, 0, hWnd);
	}


///////////////////////////////////////////////////////////////////////////////
// アプリケーションの終了時に音楽の再生を止めるために呼び出す関数
///////////////////////////////////////////////////////////////////////////////
void StopBackgroundMusic(void)
	{
	mciSendString("close all", NULL, 0, 0);
	}	


///////////////////////////////////////////////////////////////////////////////
// うめき声のWAVEファイルを再生します (プレーヤーが壁にぶつかったとき）
///////////////////////////////////////////////////////////////////////////////
void sndGrunt(void)
	{
	PlaySound("datafile\\grunt.wav", NULL, SND_FILENAME | SND_ASYNC);

	// DirectSoundを使って、うめき声を再生します
	DDGrunt();
	}
	

///////////////////////////////////////////////////////////////////////////////
// 金貨の音を再生します (プレーヤーが得点を得たとき)
///////////////////////////////////////////////////////////////////////////////
void sndScore(void)
	{
	PlaySound("datafile\\score.wav", NULL, SND_FILENAME | SND_ASYNC);

	// DirectSoundで得点の音を再生します
	DDScore();
	}
